<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>广东第二师范学院海珠校区物院二楼智慧教室预约系统（仅供记录用）</title>
    <style>
        :root {
            --primary: #4a7bff;
            --secondary: #f0f5ff;
            --success: #4caf50;
            --danger: #ff5252;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: linear-gradient(135deg, var(--primary), #2c5282);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        nav {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        nav a {
            color: white;
            text-decoration: none;
            margin: 0 15px;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        nav a.active, nav a:hover {
            background: rgba(255,255,255,0.2);
        }
        .content {
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        section {
            display: none;
        }
        section.active {
            display: block;
        }
        h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 123, 255, 0.2);
        }
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }
        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .radio-group input[type="radio"] {
            width: auto;
            margin-right: 8px;
        }
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
        }
        button:hover {
            background: #2c5282;
        }
        .btn-danger {
            background: var(--danger);
        }
        .btn-danger:hover {
            background: #c62828;
        }
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .schedule-table th, .schedule-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        .schedule-table th {
            background-color: var(--secondary);
            font-weight: 600;
        }
        .schedule-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .available {
            background-color: rgba(76, 175, 80, 0.1);
        }
        .booked {
            background-color: rgba(255, 82, 82, 0.1);
        }
        .admin-login {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        .admin-controls {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 4px;
        }
        .success-message {
            background: var(--success);
            color: white;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            text-align: center;
        }
        .error-message {
            background: var(--danger);
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin-top: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>教室预约系统</h1>
            <nav>
                <a href="#" data-section="booking">预约界面</a>
                <a href="#" data-section="instructions">借用须知</a>
                <a href="#" data-section="schedule" class="active">时间安排表</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="content">
            <section id="booking" class="active">
                <h2>教室预约</h2>
                <div id="booking-success" class="success-message" style="display:none">
                    预约成功！我们已记录您的预约信息。
                </div>
                <form id="booking-form">
                    <div class="form-group">
                        <label for="name">姓名</label>
                        <input type="text" id="name" required placeholder="请输入姓名">
                        <div id="name-error" class="error-message" style="display:none"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">联系电话</label>
                        <input type="tel" id="phone" required placeholder="请输入11位手机号码">
                        <div id="phone-error" class="error-message" style="display:none"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="date">借用日期</label>
                        <input type="date" id="date" required>
                        <div id="date-error" class="error-message" style="display:none"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>借用时长</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="duration" value="1" checked> 1小时
                            </label>
                            <label>
                                <input type="radio" name="duration" value="2"> 2小时
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="time">时间段</label>
                        <select id="time" required disabled>
                            <option value="">请先选择日期和时长</option>
                        </select>
                        <div id="time-error" class="error-message" style="display:none"></div>
                    </div>
                    
                    <button type="submit">提交预约</button>
                </form>
            </section>
            
            <section id="instructions">
                <h2>借用须知</h2>
                <div style="background:#f8f9fa; padding:20px; border-radius:8px; border-left:4px solid var(--primary);">
                    <ul>
                        <li>教室开放时间为每日9:00-21:00，请在开放时间内使用</li>
                        <li>每人每次借用时长为1或2小时，需至少提前一天预约</li>
                        <li>请保持教室整洁，爱护公共设施设备</li>
                        <li>借用需遵守学校相关规定，不得进行商业活动或非法用途</li>
                        <li>如需取消或修改预约，请提前联系管理员（陈宇锋 15768819850）</li>
                        <li>禁止携带食物进入教室，保持环境卫生</li>
                        <li>节约用电，离开时请关闭所有设备及照明</li>
                        <li>网站管理员只有本教室的暂用权，如果在使用过程中有老师要使用这间教室，需让位给老师使用</li>
                    </ul>
                </div>
            </section>
            
            <section id="schedule">
                <h2>时间安排表 <span id="schedule-date"></span></h2>
                <div id="schedule-info">
                    <p>时间表每日23:00自动更新，显示次日预约安排</p>
                    <p>当前系统时间：<span id="current-time"></span></p>
                </div>
                
                <table class="schedule-table" id="schedule-table">
                    <thead>
                        <tr>
                            <th>时间段</th>
                            <th>预约人</th>
                            <th>联系电话</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-body">
                        <!-- 动态填充 -->
                    </tbody>
                </table>
                
                <div class="admin-login">
                    <h3>管理员登录</h3>
                    <div class="form-group">
                        <label for="admin-username">账号</label>
                        <input type="text" id="admin-username" placeholder="输入管理员账号">
                    </div>
                    <div class="form-group">
                        <label for="admin-password">密码</label>
                        <input type="password" id="admin-password" placeholder="输入管理员密码">
                    </div>
                    <button onclick="loginAdmin()">登录</button>
                    
                    <div id="admin-controls" class="admin-controls">
                        <h4>管理操作</h4>
                        <button class="btn-danger" onclick="clearAllBookings()">清空所有预约</button>
                        <p style="color:#666; margin-top:10px">注：清空操作不可撤销，请谨慎使用</p>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        // 初始化数据存储
        const BOOKINGS_KEY = 'classroom_bookings';
        
        // 初始化预约数据
        function initBookings() {
            const bookings = localStorage.getItem(BOOKINGS_KEY);
            if (!bookings) {
                localStorage.setItem(BOOKINGS_KEY, JSON.stringify({}));
            }
        }
        
        // 获取所有预约
        function getAllBookings() {
            return JSON.parse(localStorage.getItem(BOOKINGS_KEY)) || {};
        }
        
        // 保存预约
        function saveBookings(bookings) {
            localStorage.setItem(BOOKINGS_KEY, JSON.stringify(bookings));
        }
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            initBookings();
            
            // 导航切换
            const navLinks = document.querySelectorAll('nav a');
            const sections = document.querySelectorAll('section');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');
                    
                    // 更新导航状态
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 更新内容显示
                    sections.forEach(s => s.classList.remove('active'));
                    document.getElementById(sectionId).classList.add('active');
                    
                    // 特殊处理时间表页面
                    if (sectionId === 'schedule') {
                        updateSchedule();
                        startAutoUpdate();
                    }
                });
            });
            
            // 默认显示预约界面
            document.getElementById('booking').classList.add('active');
            document.querySelector('nav a[data-section="booking"]').classList.add('active');
            
            // 日期初始化（至少提前一天）
            const today = new Date();
            const minDate = new Date(today);
            minDate.setDate(today.getDate() + 1);
            document.getElementById('date').min = formatDate(minDate);
            document.getElementById('date').value = formatDate(minDate);
            
            // 时间选择动态更新
            document.getElementById('date').addEventListener('change', updateTimeOptions);
            document.querySelectorAll('input[name="duration"]').forEach(radio => {
                radio.addEventListener('change', updateTimeOptions);
            });
            
            // 预约表单提交
            document.getElementById('booking-form').addEventListener('submit', function(e) {
                e.preventDefault();
                if (validateForm()) {
                    saveBooking();
                    showSuccessMessage();
                }
            });
            
            // 初始化时间表
            updateSchedule();
            startAutoUpdate();
        });
        
        // 更新时间选择选项
        function updateTimeOptions() {
            const date = document.getElementById('date').value;
            const duration = parseInt(document.querySelector('input[name="duration"]:checked').value);
            const timeSelect = document.getElementById('time');
            
            // 清除之前选项
            timeSelect.innerHTML = '<option value="">请选择可用时间段</option>';
            
            if (!date) return;
            
            const bookings = getAllBookings();
            const dateBookings = bookings[date] || [];
            
            // 生成可用时间段
            const timeOptions = generateAvailableTimes(dateBookings, duration);
            
            timeOptions.forEach(option => {
                const optionEl = document.createElement('option');
                optionEl.value = option;
                optionEl.textContent = option;
                timeSelect.appendChild(optionEl);
            });
            
            timeSelect.disabled = timeOptions.length === 0;
        }
        
        // 生成可用时间段
        function generateAvailableTimes(bookings, duration) {
            const times = [];
            const startHour = 9;
            const endHour = 21 - duration;
            
            // 创建时间占用映射
            const timeMap = new Map();
            bookings.forEach(booking => {
                const start = booking.startTime;
                const end = start + booking.duration;
                for (let hour = start; hour < end; hour++) {
                    timeMap.set(hour, true);
                }
            });
            
            // 生成可用时间段
            for (let hour = startHour; hour <= endHour; hour++) {
                // 检查连续时间段是否可用
                let available = true;
                for (let i = hour; i < hour + duration; i++) {
                    if (timeMap.has(i)) {
                        available = false;
                        break;
                    }
                }
                
                if (available) {
                    const start = hour;
                    const end = hour + duration;
                    times.push(`${formatHour(start)}-${formatHour(end)}`);
                }
            }
            
            return times;
        }
        
        // 格式化小时显示
        function formatHour(hour) {
            return `${hour.toString().padStart(2, '0')}:00`;
        }
        
        // 格式化日期
        function formatDate(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // 表单验证
        function validateForm() {
            let isValid = true;
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            
            // 清除错误信息
            document.querySelectorAll('.error-message').forEach(el => {
                el.style.display = 'none';
            });
            
            // 验证姓名
            if (!name) {
                document.getElementById('name-error').textContent = '请输入姓名';
                document.getElementById('name-error').style.display = 'block';
                isValid = false;
            }
            
            // 验证电话
            const phoneRegex = /^1[3-9]\d{9}$/;
            if (!phone) {
                document.getElementById('phone-error').textContent = '请输入联系电话';
                document.getElementById('phone-error').style.display = 'block';
                isValid = false;
            } else if (!phoneRegex.test(phone)) {
                document.getElementById('phone-error').textContent = '请输入有效的11位手机号码';
                document.getElementById('phone-error').style.display = 'block';
                isValid = false;
            }
            
            // 验证日期
            const selectedDate = new Date(date);
            const today = new Date();
            today.setHours(0,0,0,0);
            const diffDays = Math.floor((selectedDate - today) / (1000 * 60 * 60 * 24));
            
            if (!date) {
                document.getElementById('date-error').textContent = '请选择借用日期';
                document.getElementById('date-error').style.display = 'block';
                isValid = false;
            } else if (diffDays < 1) {
                document.getElementById('date-error').textContent = '需至少提前一天预约';
                document.getElementById('date-error').style.display = 'block';
                isValid = false;
            }
            
            // 验证时间
            if (!time) {
                document.getElementById('time-error').textContent = '请选择时间段';
                document.getElementById('time-error').style.display = 'block';
                isValid = false;
            }
            
            return isValid;
        }
        
        // 保存预约
        function saveBooking() {
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value;
            const duration = parseInt(document.querySelector('input[name="duration"]:checked').value);
            
            // 解析时间
            const [startTime, endTime] = time.split('-').map(t => {
                const hour = parseInt(t.split(':')[0]);
                return hour;
            });
            
            // 获取现有预约
            const bookings = getAllBookings();
            const dateBookings = bookings[date] || [];
            
            // 添加新预约
            dateBookings.push({
                name,
                phone: phone.slice(-4), // 显示部分电话号码
                startTime,
                duration,
                fullPhone: phone // 完整电话存储
            });
            
            // 保存更新
            bookings[date] = dateBookings;
            saveBookings(bookings);
            
            // 重置表单
            document.getElementById('booking-form').reset();
            updateTimeOptions();
        }
        
        // 显示成功信息
        function showSuccessMessage() {
            const successEl = document.getElementById('booking-success');
            successEl.style.display = 'block';
            
            setTimeout(() => {
                successEl.style.display = 'none';
                // 切换到时间表页面
                document.querySelector('nav a[data-section="schedule"]').click();
            }, 3000);
        }
        
        // 更新时间表
        function updateSchedule() {
            const scheduleBody = document.getElementById('schedule-body');
            scheduleBody.innerHTML = '';
            
            // 获取明日日期
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            const dateStr = formatDate(tomorrow);
            document.getElementById('schedule-date').textContent = `(${dateStr})`;
            
            // 更新当前时间显示
            updateCurrentTime();
            
            // 获取预约数据
            const bookings = getAllBookings();
            const dateBookings = bookings[dateStr] || [];
            
            // 生成时间槽
            const timeSlots = [];
            for (let hour = 9; hour <= 20; hour++) {
                timeSlots.push({
                    start: hour,
                    end: hour + 1,
                    booking: null
                });
            }
            
            // 填充预约数据
            dateBookings.forEach(booking => {
                const start = booking.startTime;
                const end = start + booking.duration;
                
                for (let hour = start; hour < end; hour++) {
                    const index = hour - 9;
                    if (!timeSlots[index].booking) {
                        timeSlots[index].booking = booking;
                    }
                }
            });
            
            // 填充表格
            timeSlots.forEach(slot => {
                const row = document.createElement('tr');
                
                // 时间段
                const timeCell = document.createElement('td');
                timeCell.textContent = `${formatHour(slot.start)}-${formatHour(slot.end)}`;
                row.appendChild(timeCell);
                
                // 预约人
                const nameCell = document.createElement('td');
                nameCell.textContent = slot.booking ? slot.booking.name : '-';
                row.appendChild(nameCell);
                
                // 联系电话
                const phoneCell = document.createElement('td');
                phoneCell.textContent = slot.booking ? slot.booking.phone : '-';
                row.appendChild(phoneCell);
                
                // 状态
                const statusCell = document.createElement('td');
                statusCell.textContent = slot.booking ? '已预约' : '可预约';
                statusCell.className = slot.booking ? 'booked' : 'available';
                row.appendChild(statusCell);
                
                scheduleBody.appendChild(row);
            });
        }
        
        // 更新当前时间
        function updateCurrentTime() {
            const now = new Date();
            const timeStr = `${now.getFullYear()}年${now.getMonth() + 1}月${now.getDate()}日 ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            document.getElementById('current-time').textContent = timeStr;
        }
        
        // 自动更新时间表
        function startAutoUpdate() {
            // 每分钟更新当前时间
            setInterval(updateCurrentTime, 60000);
            
            // 每天23:00更新时间表
            setInterval(() => {
                const now = new Date();
                if (now.getHours() === 23 && now.getMinutes() === 0) {
                    updateSchedule();
                }
            }, 60000); // 每分钟检查
        }
        
        // 管理员登录
        function loginAdmin() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            // 简单验证（实际应用中应使用安全验证）
            if (username === 'admin' && password === '123456') {
                document.getElementById('admin-controls').style.display = 'block';
            } else {
                alert('账号或密码错误');
            }
        }
        
        // 清空所有预约
        function clearAllBookings() {
            if (confirm('确定要清空所有预约记录吗？此操作不可撤销！')) {
                localStorage.removeItem(BOOKINGS_KEY);
                initBookings();
                updateSchedule();
                alert('已清空所有预约记录');
            }
        }
    </script>
</body>
</html>
 
