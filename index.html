<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教室预约系统</title>
    <style>
        :root {
            --primary: #4a7bff;
            --secondary: #f0f5ff;
            --success: #4caf50;
            --danger: #ff5252;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: linear-gradient(135deg, var(--primary), #2c5282);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        nav {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        nav a {
            color: white;
            text-decoration: none;
            margin: 0 15px;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        nav a.active, nav a:hover {
            background: rgba(255,255,255,0.2);
        }
        .content {
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        section {
            display: none;
        }
        section.active {
            display: block;
        }
        h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary);
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 123, 255, 0.2);
        }
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }
        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .radio-group input[type="radio"] {
            width: auto;
            margin-right: 8px;
        }
        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
        }
        button:hover {
            background: #2c5282;
        }
        .btn-danger {
            background: var(--danger);
        }
        .btn-danger:hover {
            background: #c62828;
        }
        .btn-warning {
            background: #ff9800;
        }
        .btn-warning:hover {
            background: #e68a00;
        }
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .schedule-table th, .schedule-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        .schedule-table th {
            background-color: var(--secondary);
            font-weight: 600;
        }
        .schedule-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .available {
            background-color: rgba(76, 175, 80, 0.1);
        }
        .booked {
            background-color: rgba(255, 82, 82, 0.1);
        }
        .admin-login {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        .admin-controls {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 4px;
        }
        .admin-panel {
            display: none;
            margin-top: 20px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px;
        }
        .admin-panel h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }
        .appointment-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .appointment-table th, .appointment-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        .appointment-table th {
            background-color: var(--secondary);
        }
        .appointment-table tr:hover {
            background-color: #f5f5f5;
        }
        .action-btn {
            padding: 5px 10px;
            margin: 0 3px;
            cursor: pointer;
            border: none;
            border-radius: 3px;
            font-size: 14px;
        }
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            width: 400px;
            max-width: 90%;
        }
        .modal-title {
            margin-bottom: 15px;
            color: var(--primary);
        }
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-col {
            flex: 1;
        }
        .success-message {
            background: var(--success);
            color: white;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            text-align: center;
        }
        .error-message {
            background: var(--danger);
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin-top: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>教室预约系统</h1>
            <nav>
                <a href="#" data-section="booking">预约界面</a>
                <a href="#" data-section="instructions">借用须知</a>
                <a href="#" data-section="schedule" class="active">时间安排表</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="content">
            <section id="booking" class="active">
                <h2>教室预约</h2>
                <div id="booking-success" class="success-message" style="display:none">
                    预约成功！我们已记录您的预约信息。
                </div>
                <form id="booking-form">
                    <div class="form-group">
                        <label for="name">姓名</label>
                        <input type="text" id="name" required placeholder="请输入姓名">
                        <div id="name-error" class="error-message" style="display:none"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">联系电话</label>
                        <input type="tel" id="phone" required placeholder="请输入11位手机号码">
                        <div id="phone-error" class="error-message" style="display:none"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="date">借用日期</label>
                        <input type="date" id="date" required>
                        <div id="date-error" class="error-message" style="display:none"></div>
                    </div>
                    
                    <div class="form-group">
                        <label>借用时长</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="duration" value="1" checked> 1小时
                            </label>
                            <label>
                                <input type="radio" name="duration" value="2"> 2小时
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="time">时间段</label>
                        <select id="time" required disabled>
                            <option value="">请先选择日期和时长</option>
                        </select>
                        <div id="time-error" class="error-message" style="display:none"></div>
                    </div>
                    
                    <button type="submit">提交预约</button>
                </form>
            </section>
            
            <section id="instructions">
                <h2>借用须知</h2>
                <div style="background:#f8f9fa; padding:20px; border-radius:8px; border-left:4px solid var(--primary);">
                    <ul>
                        <li>教室开放时间为每日9:00-23:00，请在开放时间内使用</li>
                        <li>每人每次借用时长为1或2小时，需至少提前一天预约</li>
                        <li>请保持教室整洁，爱护公共设施设备</li>
                        <li>借用需遵守学校相关规定，不得进行商业活动或非法用途</li>
                        <li>如需取消或修改预约，请提前联系管理员</li>
                        <li>借用时需出示有效身份证件配合验证</li>
                        <li>禁止携带食物进入教室，保持环境卫生</li>
                        <li>节约用电，离开时请关闭所有设备及照明</li>
                    </ul>
                </div>
            </section>
            
            <section id="schedule">
                <h2>时间安排表 <span id="schedule-date"></span></h2>
                <div id="schedule-info">
                    <p>时间表每日23:00自动更新，显示次日预约安排</p>
                    <p>当前系统时间：<span id="current-time"></span></p>
                </div>
                
                <table class="schedule-table" id="schedule-table">
                    <thead>
                        <tr>
                            <th>时间段</th>
                            <th>预约人</th>
                            <th>联系电话</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody id="schedule-body">
                        <!-- 动态填充 -->
                    </tbody>
                </table>
                
                <div class="admin-login">
                    <h3>管理员登录</h3>
                    <div class="form-group">
                        <label for="admin-username">账号</label>
                        <input type="text" id="admin-username" placeholder="输入管理员账号">
                    </div>
                    <div class="form-group">
                        <label for="admin-password">密码</label>
                        <input type="password" id="admin-password" placeholder="输入管理员密码">
                    </div>
                    <button onclick="loginAdmin()">登录</button>
                    
                    <div id="admin-controls" class="admin-controls">
                        <h4>管理操作</h4>
                        <div style="margin-bottom: 10px;">
                            <button onclick="showAdminPanel('today')">查看/修改今日预约</button>
                            <button onclick="showAdminPanel('tomorrow')">查看/修改明日预约</button>
                        </div>
                        <button class="btn-danger" onclick="clearAllBookings()">清空所有预约</button>
                        <p style="color:#666; margin-top:10px">注：清空操作不可撤销，请谨慎使用</p>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- 管理员面板 -->
    <div id="admin-panel" class="admin-panel">
        <h3 id="admin-panel-title">预约管理</h3>
        <div id="admin-panel-content">
            <!-- 动态内容将在这里生成 -->
        </div>
    </div>

    <!-- 编辑预约模态框 -->
    <div id="edit-modal" class="edit-modal">
        <div class="modal-content">
            <h3 class="modal-title">修改预约信息</h3>
            <form id="edit-form">
                <input type="hidden" id="edit-date">
                <input type="hidden" id="edit-start-time">
                
                <div class="form-group">
                    <label for="edit-name">姓名</label>
                    <input type="text" id="edit-name" required>
                </div>
                
                <div class="form-group">
                    <label for="edit-phone">联系电话</label>
                    <input type="tel" id="edit-phone" required>
                </div>
                
                <div class="form-group">
                    <label>借用时长</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="edit-duration" value="1"> 1小时
                        </label>
                        <label>
                            <input type="radio" name="edit-duration" value="2"> 2小时
                        </label>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <button type="button" class="btn-warning" onclick="deleteBooking()">删除预约</button>
                    </div>
                    <div class="form-col" style="text-align: right;">
                        <button type="button" onclick="closeModal()">取消</button>
                        <button type="submit">保存修改</button>
                    </div>
                </div>
            </form>
        </div>    </div>

    <script>
        // 初始化数据存储
        const BOOKINGS_KEY = 'classroom_bookings';
        let isAdminLoggedIn = false;
        let currentAdminView = null; // 'today' 或 'tomorrow'
        
        // 初始化预约数据
        function initBookings() {
            const bookings = localStorage.getItem(BOOKINGS_KEY);
            if (!bookings) {
                localStorage.setItem(BOOKINGS_KEY, JSON.stringify({}));
            }
        }
        
        // 获取所有预约
        function getAllBookings() {
            return JSON.parse(localStorage.getItem(BOOKINGS_KEY)) || {};
        }
        
        // 保存预约
        function saveBookings(bookings) {
 Date();
            const minDate = new Date(today);
            minDate.setDate(today.getDate() + 1);
            document.getElementById('date').min = formatDate(minDate);
            document.getElementById('date').value = formatDate(minDate);
            
            // 时间选择动态更新
            document.getElementById('date').addEventListener('change', updateTimeOptions);
            document.querySelectorAll('input[name="duration"]').forEach(radio => {
                radio.addEventListener('change', updateTimeOptions);
            });
            
            // 预约表单提交
            document.getElementById('booking-form').addEventListener('submit', function(e) {
                e.preventDefault();
                if (validateForm()) {
                    saveBooking();
                    showSuccessMessage();
                }
            });
            
            // 编辑表单提交
            document.getElementById hour; i < hour + duration; i++) {
                    if (timeMap.has(i)) {
                        available = false;
                        break;
                    }
                }
                
                if (available) {
                    const start = hour;
                    const end = hour + duration;
                    times.push(`${formatHour(start)}-${formatHour(end)}`);
                }
            }
            
            return times;
        }
        
        // 格式化小时显示
        function formatHour(hour) {
            return `${hour.toString().padStart(2, '0')}:00`;
        }
        
        // 格式化日期
        function formatDate(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).();
            today.setHours(0,0,0,0);
            const diffDays = Math.floor((selectedDate - today) / (1000 * 60 * 60 * 24));
            
            if (!date) {
                document.getElementById('date-error').textContent = '请选择借用日期';
                document.getElementById('date-error').style.display = 'block';
                isValid = false;
            } else if (diffDays < 1) {
                document.getElementById('date-error').textContent = '需至少提前一天预约';
                document.getElementById('date-error').style.display = 'block';
                isValid = false;
            }
            
            // 验证时间
            if (!time) {
                document.getElementById('time-error').textContent = '请选择时间段';
                    start: hour,
                    end: hour + 1,
                    booking: null
                });
            }
            
            // 填充预约数据
            dateBookings.forEach(booking => {
                const start = booking.startTime;
                const end = start + booking.duration;
                
                for (let hour = start; hour < end; hour++) {
                    const index = hour - 9;
                    if (!timeSlots[index].booking) {
                        timeSlots[index].booking = booking;
                    }
                }
            });
            
            // 填充表格
            timeSlots.forEach(slot => {
                const row = document.createElement('tr');
                
                // 时间段
                const timeCell = document.createElement('td');                timeCell.textContent = `${Hour(slot. username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            // 简单验证（实际应用中应使用安全验证）
            if (username === 'admin' && password === '123456') {
                isAdminLoggedIn = true;
                document.getElementById('admin-controls').style.display = 'block';
                document.getElementById('admin-username').value = '';
                document.getElementById('admin-password').value = '';
            } else {
                alert('账号或密码错误');
            }
        }
        
        // 清空所有预约
        function clearAllBookings() {
            if (confirm('确定要清空所有预约记录吗？此操作不可撤销！')) {
                localStorage.removeItem(BOOKINGS_KEY);
                initBook(小时)</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            if (dateBookings.length === 0) {
                html += `<tr><td colspan="5" style="text-align: center; padding: 20px;">暂无预约记录</td></tr>`;
            } else {
                // 生成时间槽
                const timeSlots = [];
                for (let hour = 9; hour <= 22; hour++) {
                    timeSlots.push({
                        start: hour,
                        end: hour + 1,
                        booking: null
                    });
                }
                
                // 填充预约数据
                dateBookings.forEach(booking => {
                    const start = booking
            // 获取现有预约数据
            const bookings = getAllBookings();
            const dateBookings = bookings[date] || [];
            
            // 找到要修改的预约
            const bookingIndex = dateBookings.findIndex(b => 
                b.startTime === startTime
            );
            
            if (bookingIndex !== -1) {
                // 更新预约信息
                dateBookings[bookingIndex] = {
                    name,
                    phone: phone.slice(-4),
                    startTime,
                    duration,
                    fullPhone: phone
                };
                
                // 保存更新
                bookings[date] = dateBookings;
                saveBookings(bookings);
                
                // 刷新管理员面板
                if (currentAdminView) {
                    showAdminPanel(currentAdminView预约"
   - 以表格形式展示所有预约记录
   - 每条记录都有"修改"按钮

2. **预约修改功能**：
   - 点击"修改"按钮弹出编辑模态框
   - 可以修改预约人姓名、电话和借用时长
   - 提供"删除"按钮可以删除该预约

3. **界面优化**：
   - 添加了更多按钮样式（警告色、蓝色等）
   - 改进了表格显示效果
   - 添加了模态框用于编辑预约信息

4. **数据同步**：
   - 修改或删除预约后会自动更新管理员面板和时间表
   - 保持所有视图的数据一致性

### 使用方法：
1. 管理员登录（账号：admin，密码：123456）
2. 点击"查看/修改今日预约"或"查看/修改明日预约"
3. 点击对应预约记录的"修改"按钮
4. 在弹出的窗口中修改信息或删除预约
5. 确认后数据会自动保存并更新所有相关视图

这个实现允许管理员方便地查看和管理预约记录，同时保持了原有系统的所有功能。
